<div class="container py-5">
  <div class="d-flex justify-content-center align-items-center">
    <div class="w-100" style="max-width: 420px">
      <h2 class="text-center fw-bold">
        @if (isEditMode()) { Actualizar Contacto de Emergencia } @else {
        Registro de contactos de emergencia }
      </h2>
      <p class="text-center text-muted mb-4">
        @if (isEditMode()) { Edita la información del contacto de emergencia
        registrado. } @else { Registra un contacto de emergencia para una
        persona mayor. Asegúrate de que la información esté completa. }
      </p>

      <form [formGroup]="emergencyContactForm" (ngSubmit)="onSubmit()">
        <!-- Elder Selection -->
        <div class="mb-3">
          <label class="form-label">Elder</label>
          <select
            class="form-select"
            formControlName="persona_mayor_id"
            [class.is-invalid]="
              emergencyContactForm.get('persona_mayor_id')?.touched &&
              emergencyContactForm.get('persona_mayor_id')?.invalid
            "
          >
            <option value="" disabled selected>Selecciona un anciano</option>
            @for (elder of elders(); track elder.id) {
            <option [value]="elder.id">
              {{ elder.nombre }} {{ elder.apellido }}
            </option>
            }
          </select>
          @if (emergencyContactForm.get('persona_mayor_id')?.touched &&
          emergencyContactForm.get('persona_mayor_id')?.invalid) {
          <div class="invalid-feedback d-block">
            Debes seleccionar un anciano.
          </div>
          }
        </div>

        <!-- Contact Name -->
        <div class="mb-3">
          <label class="form-label">Nombre del contacto</label>
          <input
            type="text"
            class="form-control"
            placeholder="Nombre completo"
            formControlName="nombre"
            [class.is-invalid]="
              emergencyContactForm.get('nombre')?.touched &&
              emergencyContactForm.get('nombre')?.invalid
            "
          />
          @if (emergencyContactForm.get('nombre')?.touched &&
          emergencyContactForm.get('nombre')?.invalid) {
          <div class="invalid-feedback d-block">
            El nombre es obligatorio (mínimo 2 caracteres).
          </div>
          }
        </div>

        <!-- Phone Number -->
        <div class="mb-3">
          <label class="form-label">Número de teléfono</label>
          <input
            type="text"
            class="form-control"
            placeholder="e.g. 0987654321"
            formControlName="telefono"
            [class.is-invalid]="
              emergencyContactForm.get('telefono')?.touched &&
              emergencyContactForm.get('telefono')?.invalid
            "
          />
          @if (emergencyContactForm.get('telefono')?.touched &&
          emergencyContactForm.get('telefono')?.invalid) {
          <div class="invalid-feedback d-block">
            Ingresa un número de teléfono válido (7-15 dígitos).
          </div>
          }
        </div>

        <!-- Relationship -->
        <div class="mb-3">
          <label class="form-label">Relación</label>
          <input
            type="text"
            class="form-control"
            placeholder="Relación con la persona mayor"
            formControlName="relacion"
            [class.is-invalid]="
              emergencyContactForm.get('relacion')?.touched &&
              emergencyContactForm.get('relacion')?.invalid
            "
          />
          @if (emergencyContactForm.get('relacion')?.touched &&
          emergencyContactForm.get('relacion')?.invalid) {
          <div class="invalid-feedback d-block">
            Ingresa la relación (mínimo 2 caracteres).
          </div>
          }
        </div>

        <!-- Is Doctor -->
        <div class="mb-3">
          <label class="form-label">¿Es doctor?</label>
          <select
            class="form-select"
            formControlName="es_medico"
            [class.is-invalid]="
              emergencyContactForm.get('es_medico')?.touched &&
              emergencyContactForm.get('es_medico')?.invalid
            "
          >
            <option value="" disabled selected>Selecciona una opción</option>
            <option value="1">Sí</option>
            <option value="0">No</option>
          </select>
          @if (emergencyContactForm.get('es_medico')?.touched &&
          emergencyContactForm.get('es_medico')?.invalid) {
          <div class="invalid-feedback d-block">
            Selecciona si el contacto es médico o no.
          </div>
          }
        </div>

        <!-- Email -->
        <div class="mb-3">
          <label class="form-label">Correo</label>
          <input
            type="text"
            class="form-control"
            placeholder="correo"
            formControlName="correo"
            [class.is-invalid]="
              emergencyContactForm.get('correo')?.touched &&
              emergencyContactForm.get('correo')?.invalid
            "
          />
          @if (emergencyContactForm.get('correo')?.touched &&
          emergencyContactForm.get('correo')?.invalid) {
          <div class="invalid-feedback d-block">El correo es obligatorio .</div>
          }
        </div>

        <!-- Submit Button -->
        <div class="d-grid">
          <button type="submit" class="btn btn-dark">
            @if (isEditMode()) { Actualizar Contacto } @else { Registrar
            Contacto de Emergencia }
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
